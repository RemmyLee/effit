{% extends "layout.html" %}

{% block title %}
<title>{{ post.title }} - Effit</title>
{% endblock %}

{% block content %}
<div class="post-item">
    <div class="post">
        <div class="vote">
            <button class="upvote" onclick="vote('{{ post.id }}', 'upvote')">↑</button>
            <span class="score">{{ post.score }}</span>
            <button class="downvote" onclick="vote('{{ post.id }}', 'downvote')">↓</button>
        </div>
        <div class="post-info">
            <h3><a class="title may-blank loggedin" href="{{ url_for('post_detail', community_name=post.community.name, post_slug=post.slug) }}">{{ post.title }}</a></h3>
            <span class="domain">(<a href="{{ url_for('community_posts', community_name=post.community.name) }}">self.{{ post.community.name }}</a>)</span>
            <p class="tagline">
                <span>{{ post.score }} points</span> 
                submitted <time datetime="{{ post.created_at.isoformat() }}">{{ post.created_at }}</time>
                by <a href="{{ url_for('user_posts', username=post.author.username) }}" class="author may-blank id-t2_d2kpf">{{ post.author.username }}</a>
                to <a href="{{ url_for('community_posts', community_name=post.community.name) }}" class="subreddit hover may-blank">{{ post.community.name }}</a>
            </p>
            <ul class="flat-list buttons">
                <li class="first">
                    <a href="{{ url_for('post_detail', community_name=post.community.name, post_slug=post.slug) }}" class="bylink comments may-blank" rel="nofollow">
                        {{ post.comments|length }} comments
                    </a>
                </li>
                <li class="share"><a class="post-sharing-button">share</a></li>
                <li class="link-save-button save-button login-required"><a>save</a></li>
                <li class="give-gold-button"><a href="#" class="give-gold login-required access-required gold-give-gold" rel="nofollow">give award</a></li>
                <li class="report-button login-required"><a href="#" class="reportbtn access-required">report</a></li>
                <li class="crosspost-button"><a class="post-crosspost-button">crosspost</a></li>
            </ul>
        </div>
        
    </div>
</div>

{% if "username" in session and session["username"] == post.author.username %}
<div class="post-actions">
    <form action="{{ url_for('delete_post', post_id=post.id) }}" method="post">
        <button type="submit" class="btn btn-danger">Delete</button>
    </form>
    <a href="{{ url_for('edit_post', post_id=post.id) }}" class="btn btn-primary">Edit</a>
</div>
{% endif %}

<div class="comments">
    {% for comment in comments %}
    <div class="comment">
        <p>{{ comment.content|safe }}</p>
        <p>Commented by: {{ comment.author.username }}</p>
    </div>
    {% endfor %}
</div>

<form action="{{ url_for('add_comment', post_id=post.id) }}" method="post">
    <div class="comment-form">
        <textarea id="comment-textarea" name="content" rows="4" placeholder="Add a comment..."></textarea>
        <input type="submit" value="Submit">
    </div>
</form>
<script>
    var converter = new showdown.Converter();
    var commentTextarea = document.getElementById("comment-textarea");
    var simpleMDE = new SimpleMDE({
        element: commentTextarea,
        previewRender: function (plainText) {
            return converter.makeHtml(plainText);
        }
    });
</script>
<script>
    function vote(postId, action) {
        // Perform a fetch or AJAX request to your server here. 
        // You will need to pass the postId and action ('upvote' or 'downvote') to the server.
        // Once the server responds, update the score on the page.
        fetch(`/vote?postId=${postId}&action=${action}`)
            .then(response => response.json())
            .then(data => {
                // Assuming the server returns a JSON object with the new score
                document.querySelector(`#score-${postId}`).textContent = data.newScore;
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }
    </script>
{% endblock %}




